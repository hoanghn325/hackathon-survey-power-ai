<form class="form-survey" [formGroup]="form">
  <div class="survey-section">
    <h2>NPS Advanced Analysis</h2>
    <h3> Import Data </h3>
    <div class="action">
      <button [disabled]="isLoadingProcess" (click)="csvImport.click()" id="upload-csv-btn" nzType="primary" nz-button>
        {{ 'Import File' }}
        <span nz-icon nzType="import" nzTheme="outline"></span>
      </button>
      <input #csvImport (change)="handleImportCSV($event)" [accept]="'.csv'" hidden="true" type="file" />
      <button *ngIf="showProcessBtn" [disabled]="isLoadingProcess" nz-button nzType="default" (click)="showSurvey()"
        nzDanger>{{ 'Process' }}
        <span nz-icon nzType="bulb" nzTheme="outline"></span>
      </button>
      <nz-spin *ngIf="isLoadingProcess" nzSimple [nzSize]="'small'"></nz-spin>
    </div>
    <div class="section-question" *ngIf="showTable">
      <span>Details</span>
      <div class="more-question">
        <div>{{ 'Use AI to interact with your data here:' }}</div>
        <input (keydown.enter)="mappingTheme()" [formControl]="questionFormControl" class="query" nz-input type="text"
          placeholder="Input command here" />
      </div>
      <div class="result">
        <div>
          <!-- <img src="../../../assets/images/image-chat.gif"> -->
          <!-- <img src="../../../assets/images/info.gif"> -->
          <!-- <img src="../../../assets/images/shooting-star.gif"> -->
          <img src="../../../assets/images/abc.gif">
          <!-- <img src="../../../assets/images/customer-experience.gif"> -->
        </div>
        <div>
          Here is a summary of the key findings from analyzing the NPS data:
          <div>Overall Sentiment: </div>
          <ul>
            <li>
              The average NPS score is 4.8, indicating poor customer satisfaction overall.
            </li>
            <li>
              64% of respondents are detractors (score 0-6), 23% are passives (7-8), and only 13% are promoters (9-10).
            </li>
          </ul>
          <div>
            Key Feedback Themes:
          </div>
          <ul>
            <li>
              UI/UX issues - 27% of comments mentioned the platform is not user friendly, too complicated, confusing, or
              hard to navigate.
            </li>
            <li>
              Feature requests - 25% of comments asked for new features like shortcuts, better search, more
              customizations.
            </li>
            <li>
              Business value concerns - 16% questioned the value or thought the platform was costly.
            </li>
            <li>
              Performance issues - 10% mentioned slow loading times or waiting too long.
            <li>
              Positive feedback was mostly around ease of use and helpful instructions.
            </li>
          </ul>
          <div>
            User Profile:
          </div>
          <ul>
            <li>
              Roles: Mainly inspectors, account owners, and admins.
            </li>
            <li>
              Industries: Suppliers, factories, retailers, inspection agencies.
            </li>
            <li>
              Geographies: Bangladesh, India, Guatemala, Turkey, others.
            </li>

          </ul>
          <div>
            In summary, the NPS data indicates overall dissatisfaction driven by usability challenges, desired feature
            improvements, and unclear business value. Addressing the UI/UX, adding commonly requested features, and
            communicating the value proposition could help improve satisfaction.
          </div>
        </div>
      </div>
    </div>
    <ng-container *ngIf="showTable" class="table-data">
      <nz-table nzTemplateMode [nzLoading]="isLoadingTable" [nzData]="importedData" [nzShowPagination]="false"
        [nzBordered]="true" [nzScroll]="{ y: '400px' }">
        <thead>
          <tr>
            <ng-container *ngFor="let column of columns">
              <th [nzColumnKey]="column.key" [nzWidth]="column.width">{{ column.title }}
              </th>
            </ng-container>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of importedData;">
            <td>{{ item.id }}</td>
            <td>{{ item.score }}</td>
            <td>{{ item.text }}</td>
            <td>{{ item.responseDate }}</td>
            <td>{{ item.country }}</td>
            <td>{{ item.userRole }}</td>
            <td>{{ item.organization }}</td>
            <td>{{ item.source }}</td>
            <td>{{ item.plan }}</td>
            <td>{{ item.ecosystem }}</td>
            <td>{{ item.coreChannel }}</td>
            <td>{{ item.coreEndUserAgeAmount }}</td>
            <td>
              <!-- For Theme -->
              <nz-select [(ngModel)]="item.theme" [ngModelOptions]="{standalone: true}"
                (ngModelChange)="themChanged($event, item.theme)" class="theme-dropdown">
                <nz-option *ngFor="let item of themeOptions" [nzValue]="item.id" [nzLabel]="item.text"></nz-option>
              </nz-select>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </ng-container>
  </div>
</form>